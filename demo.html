<!DOCTYPE html>
<html>

<head>
  <title>dynamicaudio demo</title>
</head>

<body>
  <input type="text" size="4" id="freq" value="440" onchange="setFreq()"><label for="hz">Hz</label>
  <button onclick="start()">play</button>
  <button onclick="stop()">stop</button>

  <script type="text/javascript" src="dist/dynamicaudio.js"></script>
  <script type="text/javascript" charset="utf-8">
    var sampledata = [];
    var output = new dynamicaudio.DynamicAudio();
    var interval = null;

    var sampleRate = 44100;
    var currentPhase = 0.0;
    var bufferSize = 44100;
    var freq = null;
    var phaseIncrement = null;

    function setFreq() {
      freq = parseFloat(document.getElementById("freq").value);
      phaseIncrement = 2 * Math.PI * freq / sampleRate;
    }
    setFreq();

    function generateSamples(n) {
      var samples = new Array(n * 2);
      for (var i = 0; i < n; i++) {
        var sample = Math.sin(currentPhase)
        samples[i * 2] = sample;
        samples[i * 2 + 1] = sample;
        currentPhase += phaseIncrement;
      }
      return samples;
    };

    function start() {
      stop();

      interval = setInterval(function() {
        output.write(generateSamples(bufferSize));
      }, 1000 / (sampleRate / bufferSize));
    }

    function stop() {
      if (interval != null) {
        clearInterval(interval);
        interval = null;
      }
    }
  </script>
</body>
